
/* 
 * Energia Materna - CSS e instruções para incorporação no Wix
 * Versão robusta com suporte a CORS e comunicação bidirecional
 */

/* ESTILOS CSS */
.responsive-iframe-container {
  position: relative;
  width: 100%;
  height: 0;
  padding-bottom: 150%; /* Proporção de aspecto ajustável conforme necessidade */
  overflow: hidden;
}

.responsive-iframe-container iframe {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  border: none;
}

/*
INSTRUÇÕES DE USO NO WIX:

1. No seu site Wix, adicione um elemento HTML
2. Clique para editar o HTML
3. APAGUE todo o conteúdo que estiver lá
4. COPIE e COLE o código abaixo (SEM incluir as marcações de comentário):

----- INÍCIO DO CÓDIGO PARA COPIAR (NÃO INCLUA ESTA LINHA) -----

<div id="birth-plan-container" class="responsive-iframe-container">
  <iframe id="birth-plan-iframe" src="https://planodeparto.energiamaterna.com.br/#/embedded-plano" allow="cross-origin-isolated; fullscreen" scrolling="no" referrerpolicy="origin"></iframe>
</div>

<style>
  .responsive-iframe-container {
    position: relative;
    width: 100%;
    height: 0;
    padding-bottom: 150%;
    overflow: hidden;
  }
  
  .responsive-iframe-container iframe {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    border: none;
  }
</style>

<script>
  // Função para ajustar altura do iframe automaticamente
  function setupIframeResizing() {
    const iframe = document.getElementById('birth-plan-iframe');
    const container = document.getElementById('birth-plan-container');
    
    // Listener para mensagens do iframe
    window.addEventListener('message', function(event) {
      console.log("Mensagem recebida do iframe:", event.data);
      
      // Verificar origem da mensagem para segurança (opcional)
      // if (event.origin !== "https://planodeparto.energiamaterna.com.br") return;
      
      // Verificar se a mensagem é do tipo resize
      if (event.data && event.data.type === 'resize') {
        // Ajustar altura do iframe
        iframe.style.height = event.data.height + 'px';
        
        // Ajustar o container
        container.style.height = event.data.height + 'px';
        container.style.paddingBottom = '0';
      }
    });
    
    // Função para verificar se o iframe está carregado
    function checkIframeLoaded() {
      try {
        // Envia mensagem para o iframe
        iframe.contentWindow.postMessage({ type: 'wix-check' }, '*');
        console.log("Mensagem enviada para o iframe");
      } catch (e) {
        console.log("Erro ao verificar iframe:", e);
      }
    }
    
    // Verifica periódicamente o carregamento
    const checkInterval = setInterval(checkIframeLoaded, 2000);
    
    // Limpa o intervalo após 30 segundos (15 tentativas)
    setTimeout(() => {
      clearInterval(checkInterval);
    }, 30000);
    
    // Inicia verificação após delay inicial
    setTimeout(checkIframeLoaded, 1000);
  }
  
  // Iniciar o ajuste de altura quando a página carregar
  if (document.readyState === 'complete') {
    setupIframeResizing();
  } else {
    window.addEventListener('load', setupIframeResizing);
  }
</script>

----- FIM DO CÓDIGO PARA COPIAR (NÃO INCLUA ESTA LINHA) -----

INSTRUÇÕES PARA GUIA ONLINE:

Para incorporar o Guia Online, use o mesmo formato, mas altere o URL para:
https://planodeparto.energiamaterna.com.br/#/embedded-guia

<div id="guide-container" class="responsive-iframe-container">
  <iframe id="guide-iframe" src="https://planodeparto.energiamaterna.com.br/#/embedded-guia" allow="cross-origin-isolated; fullscreen" scrolling="no" referrerpolicy="origin"></iframe>
</div>

<style>
  .responsive-iframe-container {
    position: relative;
    width: 100%;
    height: 0;
    padding-bottom: 150%;
    overflow: hidden;
  }
  
  .responsive-iframe-container iframe {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    border: none;
  }
</style>

<script>
  // Função para ajustar altura do iframe automaticamente
  function setupIframeResizing() {
    const iframe = document.getElementById('guide-iframe');
    const container = document.getElementById('guide-container');
    
    // Listener para mensagens do iframe
    window.addEventListener('message', function(event) {
      console.log("Mensagem recebida do iframe:", event.data);
      
      // Verificar se a mensagem é do tipo resize
      if (event.data && event.data.type === 'resize') {
        // Ajustar altura do iframe
        iframe.style.height = event.data.height + 'px';
        
        // Ajustar o container
        container.style.height = event.data.height + 'px';
        container.style.paddingBottom = '0';
      }
    });
    
    // Função para verificar se o iframe está carregado
    function checkIframeLoaded() {
      try {
        // Envia mensagem para o iframe
        iframe.contentWindow.postMessage({ type: 'wix-check' }, '*');
        console.log("Mensagem enviada para o iframe");
      } catch (e) {
        console.log("Erro ao verificar iframe:", e);
      }
    }
    
    // Verifica periódicamente o carregamento
    const checkInterval = setInterval(checkIframeLoaded, 2000);
    
    // Limpa o intervalo após 30 segundos (15 tentativas)
    setTimeout(() => {
      clearInterval(checkInterval);
    }, 30000);
    
    // Inicia verificação após delay inicial
    setTimeout(checkIframeLoaded, 1000);
  }
  
  // Iniciar o ajuste de altura quando a página carregar
  if (document.readyState === 'complete') {
    setupIframeResizing();
  } else {
    window.addEventListener('load', setupIframeResizing);
  }
</script>

SOLUÇÃO DE PROBLEMAS:

Se o iframe não estiver se ajustando corretamente:

1. Verifique se as permissões do iframe incluem "allow="cross-origin-isolated; fullscreen"
2. No Wix, certifique-se de que nas configurações avançadas do elemento HTML, a opção "Permitir scripts externos" está habilitada
3. Adicione o atributo "referrerpolicy="origin"" ao iframe
4. Se estiver usando HTTPS no seu site, certifique-se de que o URL do iframe também é HTTPS
5. Teste em uma janela anônima do navegador para evitar problemas de cache
6. Verifique o console do navegador (F12) para possíveis erros

Se o conteúdo não estiver sendo exibido:
1. Verifique se a URL do iframe está correta e acessível
2. Confirme que seu navegador não está bloqueando conteúdo de terceiros
3. Desative bloqueadores de anúncios temporariamente para teste
4. Adicione explicitamente permissões de domínio nas configurações de HTML do Wix

IMPORTANTE: 
- Os URLs "https://planodeparto.energiamaterna.com.br/#/embedded-plano" e "https://planodeparto.energiamaterna.com.br/#/embedded-guia" já estão prontos para uso.
- Adicione o iframe em uma página restrita apenas para usuários pagantes do Wix.
- O símbolo "#" é necessário porque estamos usando HashRouter para a navegação.
*/
