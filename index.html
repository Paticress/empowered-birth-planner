
<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Guia de Plano de Parto</title>
    <meta name="description" content="Guia completo para elaborar seu plano de parto humanizado" />
    <meta name="author" content="Energia Materna" />
    <meta property="og:image" content="/og-image.png" />
    <link rel="canonical" href="https://planodeparto.energiamaterna.com.br/" />
    
    <!-- Favicon links with multiple formats -->
    <link rel="icon" href="/favicon.ico" type="image/x-icon" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
    
    <!-- CORS Protection -->
    <meta http-equiv="Access-Control-Allow-Origin" content="*">
    <meta http-equiv="Access-Control-Allow-Methods" content="GET, POST, OPTIONS">
    <meta http-equiv="Access-Control-Allow-Headers" content="Origin, Content-Type, Accept">
    <meta http-equiv="Cross-Origin-Embedder-Policy" content="require-corp">
    <meta http-equiv="Cross-Origin-Opener-Policy" content="same-origin">
    <meta http-equiv="Content-Security-Policy" content="default-src 'self' 'unsafe-inline' 'unsafe-eval' https://unpkg.com https://cdn.jsdelivr.net https://cdnjs.cloudflare.com https://corsproxy.io https://cors-anywhere.herokuapp.com https://cors.bridged.cc data: blob:; frame-ancestors 'self' https://*.energiamaterna.com.br https://*.wix.com;">
    
    <!-- GitHub Pages SPA support -->
    <script type="text/javascript">
      // Single Page Apps for GitHub Pages
      // MIT License
      // https://github.com/rafgraph/spa-github-pages
      (function(l) {
        if (l.search[1] === '/' ) {
          var decoded = l.search.slice(1).split('&').map(function(s) { 
            return s.replace(/~and~/g, '&')
          }).join('?');
          window.history.replaceState(null, null,
              l.pathname.slice(0, -1) + decoded + l.hash
          );
        }
      }(window.location))
    </script>
    
    <!-- CORS Proxy loader - must be loaded early -->
    <script src="/proxy.js"></script>
    
    <!-- ReactJS Fallback - Ensures React is available -->
    <script src="/assets/react-cdn-fallback.js"></script>
    
    <!-- Critical CSS inline for faster render -->
    <style>
      /* Minimal styling for initial render */
      body {
        margin: 0;
        padding: 0;
        font-family: system-ui, -apple-system, sans-serif;
      }
      #root {
        min-height: 100vh;
      }
      .loading {
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100vh;
        flex-direction: column;
      }
      .loading p {
        margin-top: 1rem;
      }
    </style>
    <script async type="module" crossorigin src="/assets/index.l0sNRNKZ.js"></script>
  </head>

  <body>
    <div id="root">
      <!-- Fallback content while JavaScript loads -->
      <div class="loading">
        <p>Carregando Guia de Plano de Parto...</p>
      </div>
    </div>
    
    <!-- GPT Engineer Script -->
    <script src="https://cdn.gpteng.co/gptengineer.js"></script>
    
    <!-- Enhanced script loading with multiple fallbacks -->
    <script>
      // Flag to track load state and prevent double loading
      window.__SCRIPT_LOAD_STATE = {
        react: false,
        reactDom: false,
        reactRouter: false,
        app: false,
        errorCount: 0
      };
      
      // Preload dependencies with robust error handling
      function loadDependencies() {
        console.log("Starting enhanced script loading process");
        
        // Function to load React
        function loadReact(callback) {
          if (window.__SCRIPT_LOAD_STATE.react) {
            callback();
            return;
          }
          
          // Check if React is already defined
          if (typeof React !== 'undefined') {
            console.log("React already loaded");
            window.__SCRIPT_LOAD_STATE.react = true;
            callback();
            return;
          }
          
          // Use our enhanced CORS loader if available, otherwise fallback to direct loading
          if (window.__loadScriptWithCORS) {
            window.__loadScriptWithCORS(
              "https://unpkg.com/react@18/umd/react.production.min.js",
              function() {
                console.log("React loaded via CORS proxy");
                window.__SCRIPT_LOAD_STATE.react = true;
                callback();
              },
              { crossorigin: "anonymous" }
            );
          } else {
            // Fallback to direct loading with error handling
            const reactScript = document.createElement('script');
            reactScript.src = "https://unpkg.com/react@18/umd/react.production.min.js";
            reactScript.crossOrigin = "anonymous";
            reactScript.onload = function() {
              console.log("React loaded directly");
              window.__SCRIPT_LOAD_STATE.react = true;
              callback();
            };
            reactScript.onerror = function(error) {
              console.error("Failed to load React:", error);
              window.__SCRIPT_LOAD_STATE.errorCount++;
              
              // Try alternative source
              const altScript = document.createElement('script');
              altScript.src = "https://cdn.jsdelivr.net/npm/react@18/umd/react.production.min.js";
              altScript.crossOrigin = "anonymous";
              altScript.onload = function() {
                console.log("React loaded from alternative CDN");
                window.__SCRIPT_LOAD_STATE.react = true;
                callback();
              };
              altScript.onerror = function() {
                console.error("All React load attempts failed");
                // Assume the local fallback is good enough and continue
                window.__SCRIPT_LOAD_STATE.react = true;
                callback();
              };
              document.head.appendChild(altScript);
            };
            document.head.appendChild(reactScript);
          }
        }
        
        // Function to load ReactDOM
        function loadReactDOM(callback) {
          if (window.__SCRIPT_LOAD_STATE.reactDom) {
            callback();
            return;
          }
          
          // Check if ReactDOM is already defined
          if (typeof ReactDOM !== 'undefined') {
            console.log("ReactDOM already loaded");
            window.__SCRIPT_LOAD_STATE.reactDom = true;
            callback();
            return;
          }
          
          // Use our enhanced CORS loader if available
          if (window.__loadScriptWithCORS) {
            window.__loadScriptWithCORS(
              "https://unpkg.com/react-dom@18/umd/react-dom.production.min.js",
              function() {
                console.log("ReactDOM loaded via CORS proxy");
                window.__SCRIPT_LOAD_STATE.reactDom = true;
                callback();
              },
              { crossorigin: "anonymous" }
            );
          } else {
            // Fallback to direct loading
            const reactDOMScript = document.createElement('script');
            reactDOMScript.src = "https://unpkg.com/react-dom@18/umd/react-dom.production.min.js";
            reactDOMScript.crossOrigin = "anonymous";
            reactDOMScript.onload = function() {
              console.log("ReactDOM loaded directly");
              window.__SCRIPT_LOAD_STATE.reactDom = true;
              callback();
            };
            reactDOMScript.onerror = function(error) {
              console.error("Failed to load ReactDOM:", error);
              window.__SCRIPT_LOAD_STATE.errorCount++;
              
              // Try alternative source
              const altScript = document.createElement('script');
              altScript.src = "https://cdn.jsdelivr.net/npm/react-dom@18/umd/react-dom.production.min.js";
              altScript.crossOrigin = "anonymous";
              altScript.onload = function() {
                console.log("ReactDOM loaded from alternative CDN");
                window.__SCRIPT_LOAD_STATE.reactDom = true;
                callback();
              };
              altScript.onerror = function() {
                console.error("All ReactDOM load attempts failed");
                // Assume the local fallback is good enough and continue
                window.__SCRIPT_LOAD_STATE.reactDom = true;
                callback();
              };
              document.head.appendChild(altScript);
            };
            document.head.appendChild(reactDOMScript);
          }
        }
        
        // Function to load React Router - this is the problematic one!
        function loadReactRouter(callback) {
          if (window.__SCRIPT_LOAD_STATE.reactRouter) {
            callback();
            return;
          }
          
          // Check if ReactRouterDOM is already defined
          if (typeof ReactRouterDOM !== 'undefined') {
            console.log("ReactRouterDOM already loaded");
            window.__SCRIPT_LOAD_STATE.reactRouter = true;
            callback();
            return;
          }
          
          // Try to load React Router with enhanced CORS support
          console.log("Attempting to load ReactRouterDOM with enhanced protection");
          
          // Create a special version of the script tag with explicit allow-origin
          const routerScript = document.createElement('script');
          routerScript.crossOrigin = "anonymous";
          
          // Try different approaches in sequence
          const loadRouter = () => {
            // First try with the CORS proxy helper
            if (window.__loadScriptWithCORS) {
              window.__loadScriptWithCORS(
                "https://unpkg.com/react-router-dom@6/umd/react-router-dom.production.min.js",
                function() {
                  console.log("ReactRouterDOM loaded via CORS proxy");
                  window.__SCRIPT_LOAD_STATE.reactRouter = true;
                  callback();
                },
                { crossorigin: "anonymous" }
              );
            } else {
              // Direct approach with fallbacks
              fetch("https://unpkg.com/react-router-dom@6/umd/react-router-dom.production.min.js", {
                mode: 'cors',
                credentials: 'omit'
              })
              .then(response => response.text())
              .then(content => {
                // Create an inline script with the content
                const inlineScript = document.createElement('script');
                inlineScript.textContent = content;
                inlineScript.onload = function() {
                  console.log("ReactRouterDOM loaded via fetch/inline");
                  window.__SCRIPT_LOAD_STATE.reactRouter = true;
                  callback();
                };
                document.head.appendChild(inlineScript);
              })
              .catch(error => {
                console.error("Fetch failed for ReactRouterDOM:", error);
                
                // Fall back to direct script tag
                routerScript.src = "https://unpkg.com/react-router-dom@6/umd/react-router-dom.production.min.js";
                routerScript.onload = function() {
                  console.log("ReactRouterDOM loaded directly");
                  window.__SCRIPT_LOAD_STATE.reactRouter = true;
                  callback();
                };
                routerScript.onerror = function(e) {
                  console.error("Direct script load failed for ReactRouterDOM:", e);
                  
                  // Try alternative CDN
                  const altScript = document.createElement('script');
                  altScript.src = "https://cdn.jsdelivr.net/npm/react-router-dom@6/umd/react-router-dom.production.min.js";
                  altScript.crossOrigin = "anonymous";
                  altScript.onload = function() {
                    console.log("ReactRouterDOM loaded from alternative CDN");
                    window.__SCRIPT_LOAD_STATE.reactRouter = true;
                    callback();
                  };
                  altScript.onerror = function() {
                    console.error("All ReactRouterDOM load attempts failed, using local fallback");
                    // Local fallback should already be loaded, just continue
                    window.__SCRIPT_LOAD_STATE.reactRouter = true;
                    callback();
                  };
                  document.head.appendChild(altScript);
                };
                document.head.appendChild(routerScript);
              });
            }
          };
          
          loadRouter();
        }
        
        // Load React first, then ReactDOM, then React Router
        loadReact(function() {
          loadReactDOM(function() {
            loadReactRouter(function() {
              // After all dependencies are loaded, load the app
              if (!window.__SCRIPT_LOAD_STATE.app) {
                console.log("All dependencies loaded, initializing app");
                window.__SCRIPT_LOAD_STATE.app = true;
                
                // Check status of all libraries
                if (window.__checkReactLibs) {
                  const status = window.__checkReactLibs();
                  console.log("React libraries status:", status);
                }
                
                // Load the main app
                const mainScript = document.createElement('script');
                mainScript.type = "module";
                mainScript.src = "/src/main.js";
                mainScript.onerror = function(error) {
                  console.error("Failed to load main app module:", error);
                  
                  // Try compatibility mode
                  const compatScript = document.createElement('script');
                  compatScript.src = "/src/compat-entry.js";
                  document.body.appendChild(compatScript);
                };
                document.body.appendChild(mainScript);
              }
            });
          });
        });
      }
      
      // Start loading dependencies
      loadDependencies();
      
      // Set up error handling for any initialization errors
      window.addEventListener('error', function(event) {
        console.error('Global error caught:', event.message);
        window.__SCRIPT_LOAD_STATE.errorCount++;
        
        if (window.__SCRIPT_LOAD_STATE.errorCount > 5) {
          console.warn("Multiple errors detected, trying compatibility mode");
          if (!window.__COMPAT_ENTRY_LOADED) {
            const compatScript = document.createElement('script');
            compatScript.src = '/src/compat-entry.js';
            document.body.appendChild(compatScript);
          }
        }
      });
    </script>
  </body>
</html>
