
<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Guia de Plano de Parto</title>
    <meta name="description" content="Guia completo para elaborar seu plano de parto humanizado" />
    <meta name="author" content="Energia Materna" />
    <meta property="og:image" content="./og-image.png" />
    <link rel="canonical" href="https://planodeparto.energiamaterna.com.br/" />
    <base href="/" />
    
    <!-- Favicon -->
    <link rel="icon" href="/favicon.ico" />
    
    <!-- Analytics -->
    <script defer src="https://va.vercel-analytics.com/v1/script.js"></script>
    
    <!-- Enhanced Auth token handler with improved error handling -->
    <script type="text/javascript">
      (function() {
        try {
          var fullUrl = window.location.href;
          var hostname = window.location.hostname;
          var pathname = window.location.pathname;
          var search = window.location.search; 
          var hash = window.location.hash;
          
          // Check if this is a custom domain
          var isCustomDomain = hostname !== 'localhost' && 
                             !hostname.includes('.vercel.app') && 
                             !hostname.includes('.github.io');
          
          console.log('Domain check:', { 
            hostname: hostname, 
            isCustomDomain: isCustomDomain,
            pathname: pathname
          });
          
          // Check for auth errors first before any other processing
          if (fullUrl.includes('error=') || fullUrl.includes('error_code=') || fullUrl.includes('error_description=')) {
            console.log('Auth error detected in URL - special handling needed');
            
            // Extract error parameters to preserve them
            var errorParams = '';
            
            if (pathname.includes('error=') || pathname.includes('error_code=')) {
              errorParams = pathname.substring(pathname.indexOf('error'));
            } else if (search.includes('error=') || search.includes('error_code=')) {
              errorParams = search.substring(1); // remove the ? at the beginning
            } else if (hash.includes('error=')) {
              errorParams = hash.substring(1); // remove the # at the beginning
            }
            
            // Always redirect errors to acesso-plano page with error parameters as hash
            if (errorParams) {
              console.log('Redirecting with error parameters to: /acesso-plano#' + errorParams);
              window.location.href = '/acesso-plano#' + errorParams;
              return;
            } else {
              // If we can't extract specific params but know there's an error, just go to acesso-plano
              console.log('Error detected but params not extracted, redirecting to /acesso-plano');
              window.location.href = '/acesso-plano';
              return;
            }
          }
          
          // Check for auth token in path for custom domains
          if (pathname.includes('access_token=')) {
            console.log('Custom domain with auth token in path detected - special handling');
            
            // Extract token part
            var tokenIndex = pathname.indexOf('access_token=');
            var tokenPart = pathname.substring(tokenIndex);
            
            // IMPORTANT: Direct to acesso-plano with token in hash
            console.log('Redirecting to correct path format: /acesso-plano#' + tokenPart);
            window.location.href = '/acesso-plano#' + tokenPart;
            return;
          }
          
          // Check for magic link parameters
          if (search && search.includes('access_entry=magiclink')) {
            console.log('Magic link parameter detected in query string - special handling');
            
            // Keep as query parameter, but redirect to acesso-plano
            if (!pathname.includes('/acesso-plano')) {
              console.log('Redirecting magic link to acesso-plano page');
              window.location.href = '/acesso-plano' + search;
              return;
            }
          }
          
          // Ensure access_token is always processed on the acesso-plano page
          if (fullUrl.includes('access_token=') && !pathname.includes('/acesso-plano')) {
            console.log('Auth token detected outside of acesso-plano, redirecting');
            
            // Extract token part
            var tokenIndex = fullUrl.indexOf('access_token=');
            var tokenPart = fullUrl.substring(tokenIndex);
            
            // Redirect to correct location
            window.location.href = '/acesso-plano#' + tokenPart;
            return;
          }
        } catch(e) {
          console.error('Error in auth token handler:', e);
        }
      })();
    </script>
    
    <!-- GitHub Pages SPA support - Improved version that handles auth tokens -->
    <script type="text/javascript">
      // Single Page Apps for GitHub Pages
      // MIT License
      // This script handles routing for SPAs on GitHub Pages with auth token support
      (function(l) {
        // Process path-based tokens (for custom domains)
        var pathname = l.pathname;
        var fullUrl = l.href;
        
        // If auth token is in the URL path
        if (pathname.includes('access_token=')) {
          console.log("Auth token found in path, fixing format...");
          
          // Get the token part
          var tokenIndex = pathname.indexOf('access_token=');
          var tokenPart = pathname.substring(tokenIndex);
          
          // Redirect with proper format
          l.href = '/acesso-plano#' + tokenPart;
        }
      }(window.location))
    </script>
  </head>

  <body>
    <div id="root"></div>
    <!-- IMPORTANT: DO NOT REMOVE THIS SCRIPT TAG OR THIS VERY COMMENT! -->
    <script src="https://cdn.gpteng.co/gptengineer.js" type="module"></script>
    <script type="module" src="/src/main.tsx"></script>
  </body>
</html>
